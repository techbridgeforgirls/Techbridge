{"version":3,"sources":["src/index.js"],"names":[],"mappings":";;;;;;kBAqBe,YAAY;AACzB,SAAO;AACL,aAAS;AACP,yBAAS,MAAM;AACb,YAAM,OAAO,KAAK,KAAL,CAAW,WAAX,CAAuB,SAAvB,CAAP,CADO;;AAGb,YAAI,OAAO,KAAP,CAHS;AAIb,aAAK,QAAL,CAAc,iBAAd,EAAiC;AAC/B,sCAAkB;AAChB,mBAAO,IAAP,CADgB;AAEhB,mBAAO,EAAE,UAAF,CAAa,IAAb,CAAP,CAFgB;WADa;SAAjC,EAJa;;AAWb,YAAI,IAAJ,EAAU;AACR,eAAK,gBAAL,CAAsB,MAAtB,EAA8B,cAAc;AAC1C,qBAAS,EAAE,UAAF,CAAa,IAAb,CAAT;WAD4B,CAA9B,EADQ;SAAV;OAZK;KAAT;GADF,CADyB;CAAZ;;AArBf;;;;AACA;;IAAY;;;;;;AAEZ,IAAM,gBAAgB,2IAAhB;;AAMN,IAAM,oBAAoB;AACxB,kCAAsB,MAAM;QAClB,OAAwB,KAAxB,KADkB;QACZ,SAAkB,KAAlB,OADY;QACJ,QAAU,KAAV,MADI;;;AAG1B,QAAI,EAAE,kBAAF,CAAqB,MAArB,CAAJ,EAAkC,OAAlC;AACA,QAAI,KAAK,IAAL,KAAc,SAAd,EAAyB,OAA7B;AACA,QAAI,MAAM,oBAAN,CAA2B,KAAK,IAAL,CAA/B,EAA2C,OAA3C;;AAEA,SAAK,WAAL,CAAiB,KAAK,cAAL,EAAjB,EAP0B;GADJ;CAApB","file":"index.js","sourcesContent":["import template from 'babel-template'\nimport * as t from 'babel-types'\n\nconst buildPolyfill = template(`\n  var PROMISE = typeof Promise === 'undefined'\n    ? require('es6-promise').Promise\n    : Promise\n`)\n\nconst replaceIdentifier = {\n  ReferencedIdentifier (path) {\n    const { node, parent, scope } = path\n\n    if (t.isMemberExpression(parent)) return\n    if (node.name !== 'Promise') return\n    if (scope.getBindingIdentifier(node.name)) return\n\n    path.replaceWith(this.getReplacement())\n  }\n}\n\nexport default function () {\n  return {\n    visitor: {\n      Program (path) {\n        const name = path.scope.generateUid('Promise')\n\n        let used = false\n        path.traverse(replaceIdentifier, {\n          getReplacement () {\n            used = true\n            return t.identifier(name)\n          }\n        })\n\n        if (used) {\n          path.unshiftContainer('body', buildPolyfill({\n            PROMISE: t.identifier(name)\n          }))\n        }\n      }\n    }\n  }\n}\n"]}